
<!-- saved from url=(0034)http://www.gpeters.com/home/music/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Music Explorer for Windows</title>
<style>
<!--
.abc         { 	font-family: ms sans serif, Arial, Geneva, Verdana;
	font-size: 11px;
	line-height: 14px;
	color: #E0BDAB;
	 }
.title {
	font-family: verdana, geneva, arial, sans-serif;
	font-size: 14px;
	line-height: normal;
	font-weight: bold;
	padding: 0px 0px 0px 0px;
	margin: 0px 0px 3px 0px;
}

.text {
	font-family: verdana, geneva, arial, sans-serif;
	font-size: 11px;
	color: #000000;
}

.text A:link, .text A:visited, .text A:active, .text A:hover
{
	color: #cc0000;
	text-decoration: none;
	border-bottom: #C99;
	border-width: 0px 0px 1px 0px;
	border-style: none none dotted none;
}
.bar {
	font-family: ms sans serif, Arial, Geneva, Verdana;
	font-size: 11px;
	line-height: 14px;
	color: #333333;
}
-->
</style>
</head>

<body bgcolor="#FFFFFF">

<div align="center">
  <center>
    </center><table border="0" width="100%" bgcolor="#FFFFFF" cellspacing="0" cellpadding="6">
    <tbody><tr>
      <td bgcolor="#000000" valign="middle" colspan="2">

<table border="0" cellpadding="3" width="100%">
  <tbody><tr>
    <td><font face="Arial" color="#FFFFFF" size="7">music explorer</font>
      <p class="text2"><font face="Arial" color="#FFFFFF" size="4">by geoff
      peters and gabriel lo</font></p></td>
    <td><img border="0" src="./Music Explorer for Windows_files/index.1.jpg" align="right" width="376" height="109"></td>
  </tr>
</tbody></table>
      </td>
    </tr>
  <tr>
      <td bgcolor="#FFFFFF" valign="top">

<p class="title">

<font face="Arial">Music Explorer For Windows</font>
        </p><p class="text"><b>Authors:</b><br>
        Geoff Peters (<a href="http://www.gpeters.com/home">home page</a>)
        (geoff at gpeters dot com)<br>
        Gabriel Lo</p>
<p class="text"><b>Home page:</b> <a href="http://www.gpeters.com/home/music">http://www.gpeters.com/home/music</a></p>
<p class="text"><a href="http://www.gpeters.com/home/music/#system">System Requirements</a><a href="http://www.gpeters.com/home/music/#download"><br>
Download</a><a href="http://www.gpeters.com/home/music/#installing"><br>
Installing</a><a href="http://www.gpeters.com/home/music/#main"><br>
Screenshot</a><a href="http://www.gpeters.com/home/music/#howtouse"><br>
How To Use</a><a href="http://www.gpeters.com/home/music/#discuss"><br>
Discussion</a><a href="http://www.gpeters.com/home/music/#works"><br>
How It Works</a><a href="http://www.gpeters.com/home/music/#changelog"><br>
References<br>
Change Log<br>
Known Issues/Bugs</a><a href="http://www.gpeters.com/home/music/#wishlist"><br>
Wish List</a><a href="http://www.gpeters.com/home/music/#license"><br>
License</a></p>
<p class="text">A similar program to Music Explorer that has many more features
(but costs money) is <a href="http://www.seventhstring.com/">Transcribe!
by Seventh String Software.</a></p>
<p class="text">Links:</p>
<p class="text">Look here for the best <a href="http://www.gpeters.com/weddings.php">Vancouver Wedding Music</a>.</p>
</td>
      <td bgcolor="#FFFFFF">

<p class="text">Music Explorer is a free tool to learn about the nature of music in a
visual way. It can also be used by musicians to help transcribe recorded music
by identifying hard-to-hear chords.&nbsp;</p>
<ul>
  <li>
    <p class="text">It allows you to visually identify which notes are being played in a
clip of music and instantly see how music is made up of many overtones.</p></li>
  <li>
    <p class="text">It
    uses the standard SMPTE time format to quickly select a certain part of a
    sound file to play and analyze. (SMPTE is made up of
    Hours::Minutes::Seconds::Frames where Frames range from 0 to 29.)</p></li>
  <li>
    <p class="text">It
    also allows pitches to be identified by clicking on the piano keyboard, and
    an appropriate sine wave will be played.</p></li>
</ul>
<p class="text">As stated in the license at the bottom of this document, this is free
software. Source code is available for C++/MFC, and can be used in projects
licensed under the GNU Public License. The source code would be useful for
anyone trying to write a waveform analyzer, sound player, or interactive piano
keyboard.</p>
<h2 class="title"><a name="system"></a>System Requirements</h2>
<p class="text">
To run:
</p><ul>
  <li>
    <p class="text">Microsoft
    Windows 95 or higher.</p></li>
  <li>
    <p class="text">Sound card</p></li>
</ul>
<p class="text">To compile:</p>
<ul>
  <li>
    <p class="text">Visual C++ 6.0</p></li>
</ul>
        <p class="text">It may be possible to get the application to run under Linux using
        WINE. If you have success with this, please let the authors know.</p>
<h2 class="title"><a name="download"></a>Download</h2>
<table border="1" cellpadding="3" cellspacing="0">
  <tbody><tr>
    <td class="text">File</td>
    <td class="text">Size</td>
    <td class="text">Date</td>
    <td class="text">Description</td>
  </tr>
  <tr>
    <td class="text"><a href="http://www.gpeters.com/lounge/music/musicexp101.zip">musicexp101.zip</a></td>
    <td class="text">2.21 MB</td>
    <td class="text">June 7, 2003</td>
    <td class="text">Windows installation package and source code.</td>
  </tr>
</tbody></table>
<h2 class="title">&nbsp;</h2>
<h2 class="title"><a name="installing">Installing</a></h2>
<p class="text">To install the program, unzip the file <b>musicexp10.zip</b> using Winzip,
and run the file <b>setup.exe</b>.</p>
<p class="text">If you need Winzip, get a free evaluation copy at the <a href="http://www.winzip.com/">WinZip® Home Page</a>.</p>
<h2 class="title"><a name="main"></a>Screenshot</h2>
<p class="text">The following screen shows a short sound file being analyzed
(from Kenny Barron - Passion Flower Wanton Spirit). By looking at the spikes on the graph above the notes
D, F#, A, C, E, and G# on the piano keyboard, you can tell that these pitches are present in the
currently selected part of the sound file. If you know a bit of jazz theory, you
would know that these notes make up a D9(#11) chord.</p>
<p>
<img border="0" src="./Music Explorer for Windows_files/screenshot2.jpg" width="320" height="484">
</p>
<h2 class="title"><a name="howtouse"></a>How to Use</h2>
<h3 class="bar">1. Open a file</h3>
<p class="text">Open a WAV file by choosing <b style="mso-bidi-font-weight:
normal">File, Open</b>. Most WAV file formats are supported, and more will be
added in the future. After a file is selected, there will be a short delay while
the file is processed. If you are trying to open a music file in MP3 format, you
will have to convert it to WAV first, using an MP3 decoder. If you are trying to
open a music file on an audio CD, you will need to convert it to a WAV using a
"ripper". One free decoder and ripper utility is called <a href="http://www.dbpoweramp.com/dmc.htm">dbPowerAmp</a>.</p>
<h3 class="text">2. Select a range</h3>
<p class="text">Select a range by clicking and dragging a region on the
waveform, or by using the <b>Functions,
Select Range </b>dialog. The currently
selected range will be highlighted and the start and end times of the selection
will be displayed. The frequency spectrum of the currently selected range will
be shown above the piano keyboard.</p>
<h3 class="bar">3. Click the keys on the piano keyboard</h3>
<p class="text">To identify pitches, click the keys on the piano keyboard
that are below the “spikes” on the graph. While the mouse is held down, the
sine wave corresponding to the key’s frequency will be played, and the name of
the note will be displayed in the status bar. For example, if you click on the
middle C, then <b>Clicked: 60 (C5)</b> will
be displayed, which means that the MIDI note number of middle C is 60, and it a
C in the 5<sup>th</sup> octave.</p>
<h3 class="bar">4. Play the selection</h3>
<p class="text">Click the Play button on the toolbar to play the current
selection.</p>
<h2 class="title"><a name="discuss"></a>Discussion</h2>
<p class="text">An interesting way to use this program is to discover
overtones in music. By analyzing a recording of a piano playing a note or a
chord, you can visually see that many more frequencies than the
“fundamental” are being played.</p>
<h2 class="title"> <a name="works"></a>How It Works</h2>
<h3 class="bar">Programming Language</h3>
<p class="text">This application was developed using Visual C++ 6.0 and MFC.
The application uses the Document/View architecture.</p>
<h3 class="bar">Keyboard</h3>
<p class="text">The keyboard is drawn as a repeating set of octaves which
fit across the entire width of the window. Initially, each key was drawn as a rectangle, the result of which was
thick borders around the edges of the notes. In addition, this method did not align properly with the frequency
spectrum graph, which required that the width of each note be equal. The keys are represented by their MIDI note numbers, which can be
converted to the name of the note and back.</p>
<p class="text">To fix this issue, only the top half of the keyboard was
drawn (up until the end of the black key) with each note having equal width. The bottom of half of the keyboard was drawn with lines to indicate the
extent of the white keys. With
these lines, the thick borders around the edges of the notes were eliminated, as
only the black keys needed to be drawn as rectangles. However, in the bottom half of the keyboard, the white keys were not of
equal width. This created another
issue which needed to be solved when it came time to implement note clicking.</p>
<p class="text">To calculate which note has been clicked on, the first
thing which is figured out is which half of the keyboard has been clicked in –
the top half or the bottom half. If
the top half has been clicked in, then the distance from the left edge of the
keyboard to point where the mouse button was clicked, divided by the width of a
key (since they are of equal width), is a valid representation of the note that
has been clicked. On the other
hand, if the bottom half to keyboard was where the mouse was clicked, then some
mapping needed to be done. First,
if the point that was clicked would correspond to a black key in the top half of
the keyboard, that piece of information could be used to determine what key it
is in the bottom half. Since the
lines for the white keys are always drawn in the middle of the black keys, if
the point is to the left of the middle of the black, then the corresponding
white key in the bottom half is the previous key. Otherwise, the corresponding white key is the next key. If the point that was clicked in the bottom half of the keyboard
corresponds to a white key, then it is that white key which was clicked.</p>
<h3 class="bar">Sine Wave Generator</h3>
<ul>
  <li>
    <p class="text"><b>Equal
    Temperament Tuning</b>: a formula for equal temperament tuning was used to
    calculate the correct frequency for each key on the piano keyboard. Some
    details on the mathematical aspects of music are discussed in the following
    paper by <a href="http://boris.reitman.info/">Boris Reitman</a>: <a href="http://boris.reitman.name/math_music_hist.pdf">History
    of Mathematical Approaches to Western Music</a>.</p></li>
  <li>
    <p class="text">The
    algorithm to generate the sine wave was taken from an article on Direct
    Signal Processing at <a href="http://www.chipcenter.com/dsp/images/dspsourced/DSP080201.pdf">http://www.chipcenter.com/dsp/images/dspsourced/DSP080201.pdf</a>.</p></li>
</ul>
<p class="text">The algorithm to generate the sine wave uses a table lookup
method for increased speed. The algorithm populates a table of 1024 entries with
values from the math library’s sine function. Then, the current position in
the table is calculated for each sample requested by using a normalized
frequency.</p>
<h3 class="bar">Wave File Loader and Converter</h3>
<p class="text">The code which decompresses wave files was obtained from <i>A
Programmer’s Guide to Sound</i> by Tim Kientzle. However, this code does not
support all wave compression types, so in a future version a different
decompression library will be used instead. The Music Explorer reads the entire
wave file, converts it to mono, 16 bit, and saves it into a new temporary file.
Because the file is in this specified format, it is easy to seek to any position
within the file, which is useful when only certain selections need to be
analyzed and read. This file is saved to the current Windows temporary
directory.</p>
<h3 class="bar">Wave File Player</h3>
<p class="text">Although A
Programmer’s Guide To Sound provided a class WinPlayer that uses the
Windows Wave API functions to play sound, it was not thread-safe, and did not
have any facility for stopping a sound file once it begins playing. This was a
major problem, since it is necessary to be able to stop a sound file once
started, and multiple threads are needed to allow the user to continue to use
the application at the same time a sound is playing.</p>

<p class="text">To resolve this problem, we rewrote the WinPlayer to a new,
thread-safe, more functional version. This involved creating a thread-safe queue
class to hold samples waiting to be played, adding several new worker threads,
and to coordinate the stopping and starting of threads using events and critical
sections. To help us deal with the low-level Windows Wave API functions (which
are not very easy to use), we found and modified a wrapper class which
implements standard waveform APIs in object oriented way (CWaveForm).</p>

<h3 class="bar">Waveform Graph</h3>
<p class="text">To draw the waveform graph, a representation of one element
of the waveform had to be created. This
was designed as a WavePulse, which contained the time the pulse occurs, and its
magnitude.The time for a pulse is
represented using the CAudioTime, an extension of the SMPTE time code. Instead of using lines to draw each WavePulse, rectangles were used to
create a more continuous waveform.This
required the calculation of where the next WavePulse would begin, and if there
wasn’t one, then were the next unit of time would begin. Both of these were time-to-pixel conversions.</p>

<p class="text">Calculating a selection range involved converting from the
pixel values where the mouse was clicked, and the time that it represented.

That is, it was a pixel-to-time conversion.</p>
<h3 class="text">Fourier Transform</h3>
<p class="text">A Fourier transform was used to obtain the frequency
spectrum of a currently selected sound clip. The Fourier transform was computed
using a Fourier Transform library called FFTW (<a href="http://www.fftw.org/">http://www.fftw.org</a>).
For selections with less than 5000 samples, an arbitrary-length algorithm is
used. For selections with &gt;5000 samples, the nearest power of two is
calculated, and an algorithm is used which works on data sets with sizes of
powers of two. This allows extremely large selections (such as 2 million
samples) to be analyzed in mere seconds.</p>
<h3 class="bar">Frequency Spectrum Graph</h3>
<p class="text">The Fourier transform produces a resulting data set which
needs to be scaled in both the horizontal and vertical directions in order to be
displayed in the graph.</p>
<p class="text">For the horizontal direction, the formula equal temperament tuning
was used to obtain a logarithmic scaling function.</p>
<p class="text">For the vertical direction, the U-LAW logarithmic scaling function
was used. (U-LAW is a common standard which is also used for encoding samples.)</p>
<h3 class="bar">Time (SMPTE)</h3>
<p class="text">In order to keep track of the current selection, a special
time representation was used.</p>
<p class="text">The SMPTE time format is a standard developed by the Society
of Motion Picture and Television Engineers for recording equipment. It is
represented by Hours::Minutes::Seconds::Frames where frames range from 0 to 29.</p>
<p class="text">A special class was created to keep track of SMPTE time, to
calculate ranges and convert between numbers of samples and time values.</p>
<p class="text">Internally, more accuracy is stored, which is necessary to draw a
more detailed-looking waveform.</p>
<h2 class="title"><a name="references"></a>References</h2>
<p class="text">Code was obtained and modified from the following sources:</p>
<ul>
  <li>
    <p class="text">A
    Programmer’s Guide to Sound by Tim Kientzle, 1998, Addison-Wesley.</p></li>
  <li>
    <p class="text">FFTW
    Fourier transform library. <a href="http://www.fftw.org/">http://www.fftw.org</a></p></li>
  <li>
    <p class="text">CWaveForm
    class from <a href="http://www.codeproject.com/audio/cwaveform.asp">http://www.codeproject.com/audio/cwaveform.asp</a></p></li>
</ul>

<p class="text">This program was originally a project for CMPT 365 -
Multimedia Systems at Simon Fraser University in British Columbia, Canada. The
professor was Mark Drew and the teaching assistant Cheng Lu.</p>

<h2 class="title"><a name="changelog"></a>Change Log</h2>
<table border="1" cellpadding="2" cellspacing="0">
  <tbody><tr>
    <td class="text">Version</td>
    <td class="text">Date</td>
    <td class="text">Changes</td>
  </tr>
  <tr>
    <td class="text">1.01</td>
    <td class="text">June 7, 2003</td>
    <td class="text">
      <ul>
        <li>Changed the way the waveform is displayed so that it displays an
          average of the magnitude of all samples at each time interval instead
          of the first sample's magnitude in a time interval.</li>
        <li>Enabled the scrollbar "page" functionality.</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td class="text">1.00</td>
    <td class="text">April 8, 2003</td>
    <td class="text">Initial release</td>
  </tr>
</tbody></table>
<h2 class="title">&nbsp;</h2>
<h2 class="title"><a name="bugs"></a>Known Issues / Bugs</h2>
<ul>
  <li>
    <p class="text">Crashes if a selection is made while the wave file is playing.</p></li>
  <li>
    <p class="text">The select range dialog doesn't check if the inputted range is actually
    valid. So make sure to type carefully.</p></li>
  <li>
    <p class="text">The rightmost scroll bars seem to work strangely.</p></li>
</ul>
<h2 class="title"><a name="wishlist"></a>Wish-list</h2>
<p class="text">Please note that if you wish to code the following
features, please check with the Music Explorer web page (listed at the top of
this document) to make sure that it hasn’t been done already. Also, if you
wish to contribute your work to Music Explorer, please contact the authors.</p>
<ul>
  <li>
    <p class="text">Use
    a different wave file opener that supports more compression formats, and
    eliminate the need to use a temporary Samplefile (the following library
    supports seeking: <a href="http://www.zip.com.au/~erikd/libsndfile/">http://www.zip.com.au/~erikd/libsndfile/</a>)</p></li>
  <li>
    <p class="text">Allow
    the audio playback to be slowed down by a given amount, using the Windows
    Wave API functions that do this.</p></li>
  <li>
    <p class="text">Draw
    the waveform with a fast version of Catmull-Rom splines, as described in the
    following article: <a href="http://stevehollasch.com/cgindex/curves/catmull-rom.html">http://stevehollasch.com/cgindex/curves/catmull-rom.html</a>
    A faster version of this algorithm is in:</p></li>
</ul>
<p class="text">A recursive evaluation algorithm for a class of Catmull-Rom
splines<br>
Phillip J. Barry , Ronald N. Goldman<strong><br>
ACM SIGGRAPH Computer Graphics , Proceedings of the 15th annual conference on
Computer graphics and interactive techniques</strong> June 1988<br>
Volume 22 Issue 4</p>
<h2 class="title"><a name="license"></a>License</h2>
<p class="text">
Copyright (C) 2003 Geoff Peters and Gabriel Lo
</p><p class="text">
This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR APARTICULAR
PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA2111-1307, USA.</p>
        </td>
    </tr>
  </tbody></table>
  
</div>
<p align="center" class="text"><span style="background-color: #FFFFFF">This web page
copyright (c) 2003 <a href="http://www.gpeters.com/home">Geoff Peters</a>. Music Explorer
is copyright (c) 2003 Geoff Peters and Gabriel Lo.</span></p>



</body></html>